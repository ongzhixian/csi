# safelist
branches:
  only:
  - master
  - Csi.AuthenticationGateway


language: csharp
dist: xenial
os: linux

mono: none
dotnet: 2.1.512

env:
  - DOTNET_CLI_TELEMETRY_OPTOUT=1
  - DOTNET_SKIP_FIRST_TIME_EXPERIENCE=1

before_install:
  - sudo apt update
  - sudo apt install -y openssh-client sshpass lftp

script:
  - dotnet restore
  - dotnet build
  - pwd
  - dotnet publish Csi.AuthenticationGateway
  - ls -al
  - ls -al deploy

after_success:
  - echo "pwd" | sshpass -p $SFTP_PASSWORD sftp -o StrictHostKeyChecking=no zhixian@plato.emptool.com
  - lftp -e "mirror -R deploy /var/www/csi-auth ;quit" -u zhixian,$SFTP_PASSWORD sftp://plato.emptool.com